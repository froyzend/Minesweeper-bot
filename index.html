<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–∞–ø–µ—Ä</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f0f0f0;
      }

      #header {
        display: flex;
        justify-content: space-between;
        width: 100%;
        background-color: black;
        color: red;
        padding: 10px;
        font-size: 24px;
        position: relative;
      }

      #game {
        display: grid;
        grid-template-columns: repeat(18, 30px);
        grid-template-rows: repeat(25, 30px);
        gap: 2px;
        margin-top: 10px;
      }

      .cell {
        width: 30px;
        height: 30px;
        background-color: #e0e0e0;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 1px solid #999;
        font-size: 18px;
        cursor: pointer;
      }

      .revealed {
        background-color: #fff;
      }

      .mine {
        background-color: red;
      }

      .button {
        border: none;
        cursor: pointer;
        margin: 5px;
        padding: 10px;
        font-size: 24px;
        color: black;
        border-radius: 50%; /* –ö—Ä—É–≥–ª–∞—è —Ñ–æ—Ä–º–∞ –∫–Ω–æ–ø–æ–∫ */
        width: 40px; /* –®–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–æ–∫ */
        height: 40px; /* –í—ã—Å–æ—Ç–∞ –∫–Ω–æ–ø–æ–∫ */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #modeButton {
        background-color: white;
        color: black;
      }

      #restartButton {
        background-color: white;
        color: black;
      }
    </style>
  </head>
  <body>
    <div id="header">
      <div id="minesLeft">–ú–∏–Ω—ã: 75</div>
      <div id="timer">0</div>
    </div>
    <div>
      <button id="modeButton" class="button">–û</button>
      <button id="restartButton" class="button">üîÑ</button>
    </div>
    <div id="game"></div>

    <script>
      const rows = 25;
      const cols = 18;
      const totalMines = 75;
      let board = [];
      let gameOver = false;
      let timeTaken = 0;
      let timer;
      let minesLeft = totalMines;
      let flagMode = false;
      let longPressTimer; // –¢–∞–π–º–µ—Ä –¥–ª—è –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è

      // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã
      function initGame() {
        board = createBoard();
        renderBoard();
        startTimer();
        document.getElementById("minesLeft").textContent = minesLeft;
        gameOver = false;
      }

      // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—è –∏–≥—Ä—ã
      function createBoard() {
        const board = Array(rows)
          .fill(null)
          .map(() => Array(cols).fill({}));
        let mines = 0;

        while (mines < totalMines) {
          const row = Math.floor(Math.random() * rows);
          const col = Math.floor(Math.random() * cols);
          if (!board[row][col].mine) {
            board[row][col] = { mine: true, revealed: false, flagged: false };
            mines++;
          }
        }

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (!board[r][c].mine) {
              const adjacentMines = countAdjacentMines(board, r, c);
              board[r][c] = {
                mine: false,
                revealed: false,
                adjacentMines: adjacentMines,
                flagged: false,
              };
            }
          }
        }
        return board;
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –º–∏–Ω
      function countAdjacentMines(board, row, col) {
        let count = 0;
        for (
          let r = Math.max(0, row - 1);
          r <= Math.min(rows - 1, row + 1);
          r++
        ) {
          for (
            let c = Math.max(0, col - 1);
            c <= Math.min(cols - 1, col + 1);
            c++
          ) {
            if (board[r][c].mine) count++;
          }
        }
        return count;
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ–ª—è
      function renderBoard() {
        const gameDiv = document.getElementById("game");
        gameDiv.innerHTML = "";
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            const cellData = board[r][c];

            if (cellData.revealed) {
              if (cellData.mine) {
                cell.classList.add("mine");
              } else if (cellData.adjacentMines > 0) {
                cell.textContent = cellData.adjacentMines;
              }
              cell.classList.add("revealed");
            } else if (cellData.flagged) {
              cell.textContent = "üö©"; // –§–ª–∞–≥
            }

            // –û–±—ã—á–Ω—ã–π –∫–ª–∏–∫
            cell.addEventListener("click", () => handleClick(r, c));

            // –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞
            cell.addEventListener("mousedown", () => {
              longPressTimer = setTimeout(() => handleRightClick(r, c), 600); // 600ms –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
            });

            // –°–±—Ä–æ—Å –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è, –µ—Å–ª–∏ –æ—Ç–ø—É—â–µ–Ω–æ —Ä–∞–Ω—å—à–µ
            cell.addEventListener("mouseup", () =>
              clearTimeout(longPressTimer)
            );
            cell.addEventListener("mouseleave", () =>
              clearTimeout(longPressTimer)
            );

            gameDiv.appendChild(cell);
          }
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ —è—á–µ–π–∫—É
      function handleClick(row, col) {
        if (gameOver) return;
        const cell = board[row][col];
        if (cell.revealed || cell.flagged) return; // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–ª–∞–∂–æ–∫

        if (flagMode) {
          // –ü–æ–º–µ—Ç–∫–∞ —Ñ–ª–∞–∂–∫–æ–º
          cell.flagged = !cell.flagged;
          if (cell.flagged) {
            minesLeft--;
          } else {
            minesLeft++;
          }
          document.getElementById("minesLeft").textContent = minesLeft;
        } else {
          // –û—Ç–∫—Ä—ã—Ç–∏–µ —è—á–µ–π–∫–∏
          cell.revealed = true;
          if (cell.mine) {
            revealMines();
            gameOver = true;
            clearInterval(timer);
            alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –º–∏–Ω—É.");
            showScoreboard(); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∫–æ—Ä–±–æ—Ä–¥ –ø–æ—Å–ª–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
          } else {
            if (cell.adjacentMines === 0) {
              revealEmptyCells(row, col);
            }
            renderBoard();
          }
        }

        renderBoard();
        checkWin(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø–æ–±–µ–¥–∞
      }

      // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞ (–¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ)
      function handleRightClick(row, col) {
        if (gameOver) return;
        const cell = board[row][col];
        if (!cell.revealed) {
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–∂–æ–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–µ–æ—Ç–∫—Ä—ã—Ç—ã–µ —è—á–µ–π–∫–∏
          cell.flagged = !cell.flagged; // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥
          minesLeft += cell.flagged ? -1 : 1;
          document.getElementById("minesLeft").textContent = minesLeft;
        }
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã
      function checkWin() {
        let revealedCount = 0;
        let correctFlags = 0;

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const cell = board[r][c];
            if (cell.revealed) {
              revealedCount++;
            }
            if (cell.flagged && cell.mine) {
              correctFlags++;
            }
          }
        }

        if (revealedCount === rows * cols - totalMines) {
          gameOver = true;
          clearInterval(timer);
          alert("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤—ã –≤—ã–∏–≥—Ä–∞–ª–∏!");
          showScoreboard(); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∫–æ—Ä–±–æ—Ä–¥ –ø–æ—Å–ª–µ –≤—ã–∏–≥—Ä—ã—à–∞
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–æ—Å–µ–¥–Ω–∏—Ö —è—á–µ–µ–∫
      function revealEmptyCells(row, col) {
        const stack = [[row, col]];
        while (stack.length > 0) {
          const [r, c] = stack.pop();
          const cell = board[r][c];
          if (!cell.revealed) {
            cell.revealed = true;
            if (cell.adjacentMines === 0) {
              for (let newRow = r - 1; newRow <= r + 1; newRow++) {
                for (let newCol = c - 1; newCol <= c + 1; newCol++) {
                  if (
                    newRow >= 0 &&
                    newRow < rows &&
                    newCol >= 0 &&
                    newCol < cols
                  ) {
                    stack.push([newRow, newCol]);
                  }
                }
              }
            }
          }
        }
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –º–∏–Ω
      function revealMines() {
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const cell = board[r][c];
            if (cell.mine) {
              cell.revealed = true;
            }
          }
        }
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ä—Ç–∞ —Ç–∞–π–º–µ—Ä–∞
      function startTimer() {
        timeTaken = 0;
        timer = setInterval(() => {
          timeTaken++;
          document.getElementById("timer").textContent = timeTaken;
        }, 1000);
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–æ—Ä–±–æ—Ä–¥–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –≤–∞—à—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é)
      function showScoreboard() {
        // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–æ—Ä–±–æ—Ä–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏
        alert("–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–±–æ—Ä–¥–∞");
      }

      // –°–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
      document.getElementById("restartButton").addEventListener("click", () => {
        initGame();
      });

      // –°–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
      document.getElementById("modeButton").addEventListener("click", () => {
        flagMode = !flagMode;
        document.getElementById("modeButton").textContent = flagMode
          ? "–§"
          : "–û"; // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        document.getElementById("modeButton").style.backgroundColor = flagMode
          ? "yellow"
          : "white"; // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏
        renderBoard();
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      initGame();
    </script>
  </body>
</html>
