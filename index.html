<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 <!--   <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />-->
    <title>Minesweeper</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        -webkit-user-select: none; /* –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      #header {
        display: flex;
        justify-content: space-between;
        width: 360px;
        margin: 20px;
      }

      .info-box {
        background-color: black;
        color: red;
        font-size: 20px;
        padding: 5px;
        width: 80px;
        text-align: center;
        border-radius: 5px;
      }

      .button-text {
          width: 50px; /* –ó–∞–¥–∞–π—Ç–µ –Ω—É–∂–Ω—É—é —à–∏—Ä–∏–Ω—É */
          height: 50px; /* –ó–∞–¥–∞–π—Ç–µ –Ω—É–∂–Ω—É—é –≤—ã—Å–æ—Ç—É */
          font-size: 20px; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
          border: none; /* –£–±–µ—Ä–∏—Ç–µ —Ä–∞–º–∫—É, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞ */
          
          cursor: pointer; /* –ò–∑–º–µ–Ω–∏—Ç–µ –∫—É—Ä—Å–æ—Ä, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å */
          display: inline-block; /* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ –±–ª–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç */
          text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
          border-radius: 5px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
      
      }



      #game {
        display: grid;
        grid-template-columns: repeat(18, 20px); /* 18 —Å—Ç–æ–ª–±—Ü–æ–≤ */
        grid-template-rows: repeat(25, 20px); /* 25 —Å—Ç—Ä–æ–∫ */
        gap: 1px;
        margin: 20px auto;
        position: relative;
      }

      .cell {
        width: 20px; /* –†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ –≤–¥–≤–æ–µ –º–µ–Ω—å—à–µ */
        height: 20px; /* –†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ –≤–¥–≤–æ–µ –º–µ–Ω—å—à–µ */
        background-color: #eee;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        cursor: pointer;
      }

      .cell.revealed {
        background-color: #fff;
        cursor: default;
      }

      .cell.mine {
        background-color: rgb(255, 255, 255);
      }
    </style>
  </head>
  <body>
    <div id="header">
      <div id="minesLeft" class="info-box">75</div>
      <button
        id="modeButton"
        class="button-icon"
        radius: 50%;
        font-size: 20px;
      >ü™ì</button>
      <button
        id="restartButton"
        class="button-icon"
        radius: 50%;  
        font-size: 20px;
      >üîÑ</button>
      <div id="timer" class="info-box">0</div>
    </div>

    <div id="game"></div>

    <script src="/index.js"></script>
    <script>
      const rows = 25;
      const cols = 18;
      const totalMines = 75;
      let board = [];
      let gameOver = false;
      let timeTaken = 0;
      let timer;
      let minesLeft = totalMines;
      let flagMode = false; // –§–ª–∞–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
      let longPressTimer; // –¢–∞–π–º–µ—Ä –¥–ª—è –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è

      // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã
      function initGame() {
        board = createBoard();
        renderBoard();
        startTimer();
        document.getElementById("minesLeft").textContent = minesLeft;
        gameOver = false;
      }

      // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—è –∏–≥—Ä—ã
      function createBoard() {
        const board = Array(rows)
          .fill(null)
          .map(() => Array(cols).fill({}));
        let mines = 0;

        while (mines < totalMines) {
          const row = Math.floor(Math.random() * rows);
          const col = Math.floor(Math.random() * cols);
          if (!board[row][col].mine) {
            board[row][col] = { mine: true, revealed: false, flagged: false };
            mines++;
          }
        }

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (!board[r][c].mine) {
              const adjacentMines = countAdjacentMines(board, r, c);
              board[r][c] = {
                mine: false,
                revealed: false,
                adjacentMines: adjacentMines,
                flagged: false,
              };
            }
          }
        }
        return board;
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –º–∏–Ω
      function countAdjacentMines(board, row, col) {
        let count = 0;
        for (
          let r = Math.max(0, row - 1);
          r <= Math.min(rows - 1, row + 1);
          r++
        ) {
          for (
            let c = Math.max(0, col - 1);
            c <= Math.min(cols - 1, col + 1);
            c++
          ) {
            if (board[r][c].mine) count++;
          }
        }
        return count;
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ–ª—è
      function renderBoard() {
        const gameDiv = document.getElementById("game");
        gameDiv.innerHTML = "";
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            const cellData = board[r][c];

            if (cellData.revealed) {
              if (cellData.mine) {
                cell.classList.add("mine");
                cell.textContent = "üí£";
              } else if (cellData.adjacentMines > 0) {
                cell.textContent = cellData.adjacentMines;
              }
              cell.classList.add("revealed");
            } else if (cellData.flagged) {
              cell.textContent = "üö©";
              cell.backgroundImage = "url('images/flag.png')";
            }

            // –û–±—ã—á–Ω—ã–π –∫–ª–∏–∫
            cell.addEventListener("click", () => handleClick(r, c));

            // –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
            let longPressTimer;

            cell.addEventListener("mousedown", () => {
              longPressTimer = setTimeout(() => {
                handleRightClick(r, c);
              }, 600);
            });

            cell.addEventListener("mouseup", () => {
              clearTimeout(longPressTimer);
            });

            cell.addEventListener("mouseleave", () => {
              clearTimeout(longPressTimer);
            });

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è touchstart –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            cell.addEventListener("touchstart", () => {
              longPressTimer = setTimeout(() => {
                handleRightClick(r, c);
              }, 600);
            });

            cell.addEventListener("touchend", () => {
              clearTimeout(longPressTimer);
            });

            gameDiv.appendChild(cell);
          }
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–æ–≤
      function handleClick(row, col) {
        if (gameOver) return;
        const cell = board[row][col];

        // Prevent actions if the cell is revealed or flagged
        if (cell.revealed || cell.flagged) return; // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–ª–∞–∂–æ–∫

        // Logic for flagging the cell
        if (flagMode) {
            // –ü–æ–º–µ—Ç–∫–∞ —Ñ–ª–∞–∂–∫–æ–º
            cell.flagged = !cell.flagged;
            if (cell.flagged) {
                minesLeft--;
            } else {
                minesLeft++;
            }
            document.getElementById("minesLeft").textContent = minesLeft;
        } else {
            // Logic for opening the cell
            cell.revealed = true;
            if (cell.mine) {
                revealMines();
                gameOver = true;
                clearInterval(timer);
                alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –º–∏–Ω—É.");
            } else {
                if (cell.adjacentMines === 0) {
                    revealEmptyCells(row, col);
                }
                renderBoard();
            }
        }

        renderBoard();
    }

    // Add event listeners to your cell elements
    function addCellEventListeners(cellElement, row, col) {
        cellElement.addEventListener('click', () => handleClick(row, col)); // Mouse click
       // cellElement.addEventListener('touchstart', (event) => {
       //     event.preventDefault(); // Prevent default touch behavior
         //   handleClick(row, col); // Handle touch
      //  });
        cellElement.addEventListener("touchstart", () => {
              handleRightClick(row, col);
            });
    }
      // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–∞ (–¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ)
      function handleRightClick(row, col) {
        if (gameOver) return;
        const cell = board[row][col];
        if (!cell.revealed) {
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–∂–æ–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–µ–æ—Ç–∫—Ä—ã—Ç—ã–µ —è—á–µ–π–∫–∏
          cell.flagged = !cell.flagged; // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥
          minesLeft += cell.flagged ? -1 : 1;
          document.getElementById("minesLeft").textContent = minesLeft;
        }
        renderBoard();
      } 

      // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –º–∏–Ω
      function revealMines() {
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (board[r][c].mine) {
              board[r][c].revealed = true;
            }
          }
        }
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
      function revealEmptyCells(row, col) {
        for (
          let r = Math.max(0, row - 1);
          r <= Math.min(rows - 1, row + 1);
          r++
        ) {
          for (
            let c = Math.max(0, col - 1);
            c <= Math.min(cols - 1, col + 1);
            c++
          ) {
            const cell = board[r][c];
            if (!cell.revealed && !cell.mine && !cell.flagged) {
              cell.revealed = true;
              if (cell.adjacentMines === 0) {
                revealEmptyCells(r, c);
              }
            }
          }
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞
      function startTimer() {
        timeTaken = 0;
        clearInterval(timer);
        timer = setInterval(() => {
          timeTaken++;
          document.getElementById("timer").textContent = timeTaken;
        }, 1000);
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
      document.getElementById("restartButton").addEventListener("click", () => {
        clearInterval(timer);
        minesLeft = totalMines;
        document.getElementById("timer").textContent = "0";
        initGame();
      });

      // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
      document.getElementById("modeButton").addEventListener("click", () => {
        flagMode = !flagMode;
        const modeButton = document.getElementById("modeButton");
        if (flagMode) {
          //modeButton.style.backgroundImage = "url('images/flag.png')";
          modeButton.textContent = "üö©";
        } else {
          //modeButton.style.backgroundImage = "url('images/shovel.png')";
          modeButton.textContent = "ü™ì";
        }
      });

      // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
      initGame();
    </script>
    <script src="https://telegram.org/js/games.js"></script>
    <script src=""></script>
    <button type="button" onclick="TelegramGameProxy.shareScore()">Share Score</button>
  </body>
</html>
