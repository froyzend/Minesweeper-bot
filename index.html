<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Minesweeper</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #header {
        display: flex;
        justify-content: space-between;
        width: 360px;
        margin: 20px;
      }

      .info-box {
        background-color: black;
        color: red;
        font-size: 24px;
        padding: 10px;
        width: 100px;
        text-align: center;
        border-radius: 5px;
      }

      #modeButton {
        background-color: white;
        color: black;
        font-size: 20px;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        width: 150px;
      }

      #game {
        display: grid;
        grid-template-columns: repeat(9, 40px);
        grid-template-rows: repeat(15, 40px);
        gap: 1px;
        margin: 20px auto;
        position: relative;
      }

      .cell {
        width: 40px;
        height: 40px;
        background-color: #eee;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        user-select: none; /* –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
      }

      .cell.revealed {
        background-color: #fff;
        cursor: default;
      }

      .cell.mine {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <div id="header">
      <div id="minesLeft" class="info-box">16</div>
      <button id="modeButton">–û—Ç–∫—Ä—ã—Ç–∏–µ</button>
      <div id="timer" class="info-box">0</div>
    </div>

    <div id="game"></div>

    <script>
      const rows = 15;
      const cols = 9;
      const totalMines = 16;
      let board = [];
      let gameOver = false;
      let timeTaken = 0;
      let timer;
      let minesLeft = totalMines;
      let flagMode = false; // –§–ª–∞–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞

      // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã
      function initGame() {
        board = createBoard();
        renderBoard();
        startTimer();
        document.getElementById("minesLeft").textContent = minesLeft;
      }

      // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—è –∏–≥—Ä—ã
      function createBoard() {
        const board = Array(rows)
          .fill(null)
          .map(() => Array(cols).fill({}));
        let mines = 0;

        while (mines < totalMines) {
          const row = Math.floor(Math.random() * rows);
          const col = Math.floor(Math.random() * cols);
          if (!board[row][col].mine) {
            board[row][col] = { mine: true, revealed: false, flagged: false };
            mines++;
          }
        }

        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (!board[r][c].mine) {
              const adjacentMines = countAdjacentMines(board, r, c);
              board[r][c] = {
                mine: false,
                revealed: false,
                adjacentMines: adjacentMines,
                flagged: false,
              };
            }
          }
        }
        return board;
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –º–∏–Ω
      function countAdjacentMines(board, row, col) {
        let count = 0;
        for (
          let r = Math.max(0, row - 1);
          r <= Math.min(rows - 1, row + 1);
          r++
        ) {
          for (
            let c = Math.max(0, col - 1);
            c <= Math.min(cols - 1, col + 1);
            c++
          ) {
            if (board[r][c].mine) count++;
          }
        }
        return count;
      }

      // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ–ª—è
      function renderBoard() {
        const gameDiv = document.getElementById("game");
        gameDiv.innerHTML = "";
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            const cellData = board[r][c];

            if (cellData.revealed) {
              if (cellData.mine) {
                cell.classList.add("mine");
              } else if (cellData.adjacentMines > 0) {
                cell.textContent = cellData.adjacentMines;
              }
              cell.classList.add("revealed");
            } else if (cellData.flagged) {
              cell.textContent = "üö©";
            }

            cell.addEventListener("click", () => handleClick(r, c));
            cell.addEventListener("contextmenu", (e) => {
              e.preventDefault();
              handleRightClick(r, c);
            });

            gameDiv.appendChild(cell);
          }
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ —è—á–µ–π–∫—É
      function handleClick(row, col) {
        if (gameOver) return;
        const cell = board[row][col];
        if (cell.revealed) return;

        if (flagMode) {
          // –ü–æ–º–µ—Ç–∫–∞ —Ñ–ª–∞–∂–∫–æ–º
          cell.flagged = !cell.flagged;
          if (cell.flagged) {
            minesLeft--;
          } else {
            minesLeft++;
          }
          document.getElementById("minesLeft").textContent = minesLeft;
        } else {
          // –û—Ç–∫—Ä—ã—Ç–∏–µ —è—á–µ–π–∫–∏
          cell.revealed = true;
          if (cell.mine) {
            revealMines();
            gameOver = true;
            clearInterval(timer);
            alert("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –º–∏–Ω—É.");
          } else {
            if (cell.adjacentMines === 0) {
              revealEmptyCells(row, col);
            }
            renderBoard();
          }
        }

        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞ (–ø–æ–º–µ—Ç–∫–∞ –º–∏–Ω—ã)
      function handleRightClick(row, col) {
        if (gameOver) return;
        const cell = board[row][col];
        cell.flagged = !cell.flagged; // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ —É–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –º–∏–Ω
      function revealMines() {
        for (let r = 0; r < rows; r++) {
          for (let c = 0; c < cols; c++) {
            if (board[r][c].mine) {
              board[r][c].revealed = true;
            }
          }
        }
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
      function revealEmptyCells(row, col) {
        for (
          let r = Math.max(0, row - 1);
          r <= Math.min(rows - 1, row + 1);
          r++
        ) {
          for (
            let c = Math.max(0, col - 1);
            c <= Math.min(cols - 1, col + 1);
            c++
          ) {
            const cell = board[r][c];
            if (!cell.revealed && !cell.mine && !cell.flagged) {
              cell.revealed = true;
              if (cell.adjacentMines === 0) {
                revealEmptyCells(r, c);
              }
            }
          }
        }
        renderBoard();
      }

      // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞
      function startTimer() {
        timeTaken = 0;
        timer = setInterval(() => {
          timeTaken++;
          document.getElementById("timer").textContent = timeTaken;
        }, 1000);
      }

      // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
      document.getElementById("modeButton").addEventListener("click", () => {
        flagMode = !flagMode;
        const modeButton = document.getElementById("modeButton");
        if (flagMode) {
          modeButton.style.backgroundColor = "yellow";
          modeButton.textContent = "–§–ª–∞–∂–∫–∏";
        } else {
          modeButton.style.backgroundColor = "white";
          modeButton.textContent = "–û—Ç–∫—Ä—ã—Ç–∏–µ";
        }
      });

      // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
      initGame();
    </script>
  </body>
</html>
